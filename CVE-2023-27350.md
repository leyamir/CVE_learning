# Description
- This vulnerability allows **remote attackers** to **bypass authentication** on affected installations of PaperCut NG 22.0.5 (Build 63914). 
- Authentication is not required to exploit this vulnerability. 
- The specific flaw exists within the **SetupCompleted** class. 
- The issue results from improper access control.
- An attacker can leverage this vulnerability to **bypass authentication** and **execute arbitrary code** in the context of SYSTEM.
  
# Background

**PaperCut** 
- A popular print management software organizations use worldwide to manage printing and copying services

**Session Variable Overloading (also known as Session Puzzling)**
- This vulnerability occurs when an application uses the same session variable for more than one purpose.
- An attacker can potentially access pages in an order unanticipated by the developers so that the session variable is set in one context and then used in another.

**Some default credential**
- `admin:admin`
- Apache Tomcat - Authenticate with `tomcat:s3cr3t`
- Jenkins - Authenticate with `jenkins:jenkins`
- Almost any WiFi router - Authenticate with `admin:admin`

**Nashorn**
- The Javascript engine included in Java.
- Javascript run by nashorn can call Java class directly
- Eg. `java.lang.Runtime.getRuntime().exec('ping 8.8.8.8')` run command on system.

# Impact
- PaperCut is widely used in the world
- The expoiltation is simple

# Root cause

- Navigate to `http://ip:port/app?service=page/SetupCompleted`
- Application call `homePage.performLogin(setupData.getAdminUserName(), LoginType.Admin, false);`
- This function make the current session become `admin`
- Then navigate to `Printer`, `Template printer`, `Scripting`, `Enable print script`.
- The Javascript here run by Nashorn. So attacker can call Java class to run system command directly.

# Attack procedure

- Normally, PaperCut open webserver on port 9191 (HTTP) and 9192/9195 (HTTPS).
- Host a server.
- Curl the payload to victim machine.
- Run payload.
